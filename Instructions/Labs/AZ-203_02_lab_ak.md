---
lab:
    title: 'ラボ: サービスとしての Azure Platform での Web アプリケーションの構築'
    type: 'Answer Key'
    module: 'モジュール 2: サービスとしての Azure Platform の開発 (PaaS)コンピューティング ソリューション'
---

# ラボ: サービスとしての Azure Platform での Web アプリケーションの構築
# 受講者ラボ解答キー

## Microsoft Azure ユーザー インターフェイス

Microsoft クラウド ツールのダイナミックな性質を考えると、このトレーニング コンテンツの開発後に Azure ユーザー インターフェイス (UI) の変更が発生する可能性があります。これらの変更により、ラボの指示と手順が一致しない場合があります。

Microsoft ワールドワイド ラーニング チームは、コミュニティが必要な変更を行うとすぐに、このトレーニング コースを更新します。しかし、クラウド更新が頻繁に起きるため、この研修内容が更新される前に、UI の変更を経験するかも知れません。**その場合は変更に順応して、必要に応じてラボでをそれを処理してください。**

## 指示

### 開始する前に

#### ラボの仮想マシンへのサインイン

次の認証情報を使用して **Windows 10** 仮想マシンにサインインします。
    
-   **ユーザー名**：Admin
    
-   **パスワード**: Pa55w.rd

> **注記**：ラボ仮想マシンのサインイン手順は、インストラクターから提供されます。

#### インストールされたアプリケーションの検討

**Windows 10** デスクトップの下部にあるタスク バーを確認します。タスク バーには、このラボで使用するアプリケーションのアイコンが含まれています。
    
-   Microsoft Edge

-   エクスプローラ

-   Windows PowerShell

-   Visual Studio Code:

#### 練習用ファイルをダウンロードする

1.  タスク バーで、**Windows PowerShell** アイコンを選択します。

1.  PowerShell コマンド プロンプトで、現在の作業ディレクトリを **Allfiles (F):\\** パスに変更します。

    ```
    cd F:
    ```

1.  コマンド プロンプト内で次のコマンドを入力し、Enter キーを押して、GitHub でホストされている **microsoftlearning/AZ-203-DevelopingSolutionsforMicrosoftAzure** プロジェクトを  **Allfiles (F):\\* ドライブにクローンします。

    ```
    git clone --depth 1 --no-checkout https://github.com/microsoftlearning/AZ-203-DevelopingSolutionsForMicrosoftAzure .
    ```

1.  コマンド プロンプト内で次のコマンドを入力し、**Enter** キーを押 して、**AZ-203T02** ラボを完了するために必要なラボ ファイルをチェックアウトします。

    ```
    git checkout master -- Allfiles/*
    ```

1.  現在実行中の **Windows PowerShell** コマンド プロンプト アプリケーションを閉じます。

### エクササイズ 1: Azure Storage と API Apps を使ってバックエンド API を構築

#### タスク 1: Azure portal を開く

1.  タスク バーで、**Microsoft Edge** アイコンを選択します。

1.  開いているブラウザ ウィンドウで、[**Azure portal**](https://portal.azure.com) (portal.azure.com)に移動します。

1.  サインイン ページで、Microsoft アカウントの **電子メール アドレス**を入力します。

1.  **次へ** を選択します。

1.  Microsoft アカウントの**パスワード**を入力します。

1.  **サインイン** を選択します。

    > **注記**：Azure portalに初めてサインインする場合は、ポータルのツアーを提供するダイアログ ボックスが表示されます。ツアーをスキップしてポータルの使用を開始するには、**開始**を選択します。

#### タスク 2: Azure Storage  アカウントを作成する

1.  Azureポータルの左のナビゲーション ペインで、**すべてのサービス**をクリックします。

1.  **すべてのサービス**ブレードで、**ストレージ アカウント**を選択します。

1.  **ストレージ アカウント**ブレードで、ストレージ インスタンスの一覧を表示します。

1.  **ストレージ アカウント** ブレードの上部にある**追加**を選択 します。

1.  **ストレージ アカウントを作成**ブレードで、基本、タグ、レビュー+作成などのブレードの上部にあるタブを確認します。

    > **注記**：各タブは、ワークフロー内の新しい**ストレージ アカウント**を作成するためのステップを表 します。いつでも**レビュー + 作成**を選択して、残りのタブをスキップできます。

1.  **基本**タブを選択し、タブ領域内で次の操作を実行します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** セクションで、**新規作成**を選択し、**マネージプラットフォーム**を選択し、**OK**を選択します。
    
    1.  **ストレージ アカウント** **名** フィールドに、**imgstor\[*自分の名前を小文字*\] と**入力します。
    
    1.  **[場所]**リストで、**(US) 米国東部**リージョンを選択します。
    
    1.  **パフォーマンス** セクションで、**標準**を選択します。
    
    1.  **アカウントの種類**の一覧で、**StorageV2 (汎用v2)**を選択します。
    
    1.  **レプリケーション** リストで、**ローカル冗長ストレージ (LRS)**を選択します。
    
    1.  **アクセス層 (既定)**セクションで、**Hot** が選択されていることを確認します。
    
    1.  **レビュー + 作成**を選択します。

1.  **レビュー + 作成**タブで、前の手順で指定したオプションを確認します。

1.  指定した構成を使用してストレージ アカウントを作成するには、**作成**を選択します。

1.  [**デプロイ**] ブレードで、演習を進める前に、作成タスクが完了するまで待ちます。

1. [**デプロイ**] ブレードの [**リソースに移動**] ボタン をクリックして、新しく作成したストレージ アカウントに移動します。

1. **ストレージ アカウント**ブレードの左側にある**設定**セクションを見 つけて、**アクセス キー**を選択します。

1. **アクセス キー**ブレードで、いずれかのキーを選択し、いずれかの**接続文字列**フィールドの値を記録します。これらの値は、この演習の後半で使用します。

    > **注記**：どの接続文字列を選択しても問題ありません。それらは交換可能です。

#### タスク 3: サンプル BLOB のアップロード

1.  Azure portalの左側のナビゲーション ウィンドウで、**リソース グループ**を選択します。

1.  **リソース グループ**ブレードで、この実習ラボで作成済みの **ManagedPlatform** リソース グループを選択します。

1.  **ManagedPlatform** ブレードで、 この実習ラボで前に作成した **imgstor\**ストレージ アカウントを選択します。

1.  **ストレージ アカウント** ブレードで、ブレードの左側にある**BLOB サービス**セクションにおいて、**Containers** リンクを選択します。

1.  **Containers** セクションで、**+ コンテナー**を選択します。

1.  **新しいコンテナー** ウィンドウで、次のアクションを実行します。
    
    1.  **名前**フィールドに、**イメージ**を入力します。
    
    1.  **パブリック アクセス レベル**リストで**BLOB (BLOBのみの匿名読み取りアクセス)**を選択します。
    
    1.  **OK** を選択します。

1.  **Containers** セクションで、**+ コンテナ**をもう一度選択します。

1.  **新しいコンテナー** ウィンドウで、次のアクションを実行します。

    1.  **名前**フィールドに、**images-thumbnails** を入力します。

    1.  **パブリック アクセス レベル**リストで**BLOB (BLOBのみの匿名読み取りアクセス)**を選択します。

    1.  **OK** を選択します。

1.  **Containers** セクションで、新しく作成された**イメージ**コンテナを選択します。

1. **コンテナ** ブレードで、**アップロード**を選択します。

1. 表示される **BLOB のアップロード** ウィンドウで、次の操作を実行します：

    1.  **ファイル** セクションで、**フォルダ**アイコンを選択します。

    1.  表示されるファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images**に移動し、 **grilledcheese.jpg**ファイルを選択し、**開く**を選択します。

    1.  **ファイルが既に存在する場合は上書き**チェックボックスがオンにチェックされていることを確認します。

    1.  **アップロード**を選択します。

1. この演習を続行する前に、BLOB がアップロードされるのを待ちます。

#### タスク 4: API アプリの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある **マーケットプレースを検索** フィールドを検索します。

1.  検索フィールドに **API** を入力し、Enter キーを押します。

1.  **すべての**検索結果ブレードで、**API アプリ**の結果を選択します。

1.  **API アプリ** ブレードで、**作成**を選択します。

1.  2番目の**API アプリ**ブレードで、次のアクションを実行します。
    
    1.  **アプリ名**フィールドに、**imgapi\[*名前を小文字*\]**と入力します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** セクションで、**既存のを使用** を選択し、**マネージドプラットフォーム**を選択します。
    
    1.  **App Services  プラン/場所**フィールドを既定値に設定したままにします。
    
    1.  **アプリケーションインサイト**フィールドを既定値に設定したままにします。
    
    1.  **作成**を選択します。

1.  演習を進める前に、作成タスクが完了するまで待ちます。

#### タスク 5: API アプリの設定

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択します。

1.  **リソース グループ**ブレードで、この実習ラボで作成済みの **ManagedPlatform** リソース グループを選択します。

1.  **ManagedPlatform** ブレードで、この実習ラボで前に作成した **imgapi\** API アプリを選択します。

1.  **API アプリ** ブレードで、**設定**セクションのブレードの左側で、**構成**リンクを選択します。

1.  **構成**セクションで、次の操作を実行します：
    
    1.  [**アプリケーション設定**] タブを選択します。
    
    1.  [**+新しいアプリ設定**] を選択します。
    
    1.  表示される [**アプリケーションの追加/編集**] 設定 ポップアップで、[**名前**] フィールドに「**StorageConnectionString**」と入力します。
    
    1.  **数値**フィールドに、この実習ラボで前にコピーした**ストレージ接続文字列**を入力します。
    
    1.  **デプロイ スロット設定**フィールドを既定値のままにします。

    1.  [**OK**] を選択してポップアップを閉じ、[**構成**] セクションに戻ります。
    
    1.  ブレードの上部にある [**保存**] を選択して、設定を保持します。

1.  演習を進める前に、アプリケーションの設定が保持されるまで待ちます。

1.  **API アプリ** ブレードで、**設定**セクションのブレードの左側で、**プロパティ**リンクを選択します。

1.  **プロパティ** セクションで、**URL** フィールドの値をコピーします。これらの値は、この演習の後半で使用します。

#### タスク 6: ASP.NETコア Web アプリケーションをAPI アプリに展開する

1.  タスク バーで、**Visual Studio コード**アイコンを選択します。

1.  **ファイル** メニューで、**フォルダを開く**を選択します。

1.  開かれるファイル エクスプローラ ペインで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\API** に移動し、**フォルダの選択**を選択します。

1.  Visual Studio コード ウィンドウの **エクスプローラ** ペインで、**コントローラー**フォルダを展開し、**ImagesController.cs**ファイルをダブルクリック してエディタでファイルを開きます。

1.  エディタで、**ImageController** クラスの27行目で、**GetCloudBlobContainer** メソッドとコンテナの取得に使用されるコードを確認します。

1.  **ImagesController** クラスでは38行目で、**Get** メソッドと、**イメージ コンテナ**からすべての BLOB を非同期に取得するために使用されるコードを確認します。

1.  **ImagesController** クラスでは、74行目で**Post**メソッドと、アップロードされたイメージを Azure Storage に永続化するために使用するコードを確認します。

1.  タスク バーで、**Windows** **PowerShell**アイコンを選択します。

1.  openコマンド プロンプトで次のコマンドを入力し、Enterキーを押して Azure CLI にサインインします。

    ```
    az login
    ```

1. 表示される**Microsoft Edge**ブラウザ ウィンドウで、次の操作を実行します。
    
    1.  Microsoft アカウントの**電子メール アドレス**を入力します。
    
    2.  **次へ** を選択します。
    
    3.  Microsoft アカウントの**パスワード**を入力します。
    
    4.  **サインイン** を選択します。

1. 現在開いている**コマンド プロンプト**アプリケーションに戻ります。サインイン プロセスが完了するのを待ちます。

1. コマンド プロンプトで、次のコマンドを入力し、Enter キーを押して **ManagedPlatform** リソース グループ内のすべての**アプリ**を一覧表示します。

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1. 次のコマンドを入力し、Enterキーを押すと、 プレフィックス **imgapi\**を持つ**アプリ**が見つかります。

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')]"
    ```

1. 次のコマンドを入力し、Enter キーを押して、プレフィックス **imgapi\** を持つ単一のアプリの名前のみを印刷します。

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgapi')].{Name:name}" --output tsv
    ```

1. 次のコマンドを入力し、Enter キーを押して現在のディレクトリを **すべてのファイル(F):\\Allfiles\\Labs\\02\\Starter\\API** ディレクトリに変更するラボ ファイルを含みます。

    ```
    cd F:\Labfiles\02\Starter\API\
    ```

1. 次のコマンドを入力し、Enter キーを押して、この実習ラボで前述した**API アプリ**に**api.zip**ファイルをデプロイします。

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src api.zip --name <name-of-your-api-app>
    ```

    > **注記**: この演習で前に作成したAPI アプリの名前に、**\<name-of-your-api-app\>**プレースホルダを置き換えます。このアプリ名は、以前のステップで最近クエリしました。

1. この演習を進める前に、展開が完了するのを待ちます。

1. ポータルの左側で、**リソース グループ**リンクを選択します。

1. **リソース グループ** ブレードで、 この実習ラボで作成済みの**ManagedPlatform**リソース グループを見つけて選択します。

1. **ManagedPlatform** ブレードで、  この実習ラボで前に作成した**imgapi\** *API アプリ*を選択します。

1. **API アプリ** ブレードで、**ブラウズ**ボタンを選択します。

1. Web サイトのルートに**GET** 要求を実行し、返されるJSON 配列を観察します。このアレイには、**Azure Storage** アカウントにアップロードされた単一のイメージの URL が含まれている必要があります。

1. **Azure portal**を表示するブラウザ ウィンドウに戻ります。

#### 復習

この演習では、Azure で API アプリを作成し、Azure CLI  と Kudu の zip デプロイメント ユーティリティを使用して、ASP.NET コア Web アプリケーションを API アプリにデプロイしました。

### エクササイズ 2: Azure Web アプリを使用してフロントエンド Web アプリケーションを構築する

#### タスク 1: ウェブ アプリの構成

1.  Azure portalで、左側のナビゲーション ウィンドウで**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある**マーケットプレースを検索**フィールドを検索します。

1.  検索フィールドで、**Web**を入力し、Enter キーを押します。

1.  **すべて**の検索結果]ブレードで、**Web アプリ**の結果を選択します。

1.  **Web アプリ** ブレードで、**作成**を選択します。

1.  2番目の **Web アプリ** ブレードで、次の操作を実行します。
    
    1.  **アプリ名** フィールドに、**imgweb\[*名前を小文字*\]** と入力します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** セクションで、**既存のを使用** を選択し、**マネージドプラットフォーム**を選択します。
    
    1.  **発行**セクションで、**コード**を選択します。
    
    1.  **ランタイム スタック** セクションで、**NET Core 2.2** を選択します。
    
    1.  **OS** セクションで、** Windows**を選択 します。

    1. **リージョン** ドロップダウン リストで、**米国東部**を選択します。
    
    1.  **プラン (米国東部)**フィールドを既定値に設定したままにします。
    
    1.  **SKU と サイズ** フィールドを既定値のままにします。
    
    1.  **レビューと作成**を選択します。

1. [**レビューと作成**] タブで設定を確認し、[**作成**] をクリックします。

1.  演習を進める前に、作成タスクが完了するまで待ちます。

#### タスク 2: ウェブ アプリの構成

1.  ポータルの左側のナビゲーション ペインで、**リソース グループ**を選択します。

1.  **リソース グループ**ブレードで、この実習ラボで作成済みの**ManagedPlatform** リソース グループを選択します。

1.  **ManagedPlatform** ブレードで、 この実習ラボで作成済みの**imgweb\** Web アプリを選択します。

1.  **Web アプリ** ブレードで、**設定**セクションのブレードの左側で、**構成**リンクを選択します。

1.  **構成**セクションで、次の操作を実行します：
    
    1.  [**アプリケーション設定**] タブを選択します。
    
    1.  [**+新しいアプリ設定**] を選択します。
    
    1.  表示される [**アプリケーションの追加/編集**] 設定 ポップアップで、[**名前**] フィールドに「**ApiUrl**」と入力します。
    
    1.  **数値** フィールドに、 この実習ラボで前にコピーしたAPI アプリ**URL**を入力します。

        >**注意**: このアプリケーション設定の値フィールドにコピーする URL にプロトコル (例: *https://*) を必ず含める必要があります。
    
    1.  **デプロイ スロット設定**フィールドを既定値のままにします。

    1.  [**OK**] を選択してポップアップを閉じ、[**構成**] セクションに戻ります。
    
    1.  ブレードの上部にある [**保存**] を選択して、設定を保持します。

1.  演習を進める前に、アプリケーションの設定が保持されるまで待ちます。

#### タスク 3: ASP.NETコア Web アプリケーションをWeb アプリに展開する

1.  タスク バーで、**Visual Studio コード**アイコンを選択します。

1.  **ファイル** メニューで、**フォルダを開く**を選択します。

1.  開かれるファイル エクスプローラ ペインで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Web** に移動し、**フォルダの選択**を選択します。

1.  Visual Studio コード ウィンドウの**エクスプローラ** ウィンドウで、**Pages** フォルダを展開し、**Index.cshtml.cs** ファイルをダブルクリックしてエディタでファイルを開きます。

1.  エディタでは、**IndexModel** クラスの30行目で、**OnGetAsync** メソッドと、API からイメージのリストを取得するために使用されるコードを確認します。

1.  **IndexModel** クラスでは、52行目で **OnPostAsync** メソッドと、アップロードされたイメージをバックエンド API にストリーミングするために使用されるコードを確認します。

1.  タスク バーで、**Windows** **PowerShell** アイコンを選択します。

1.  open コマンド プロンプトで次のコマンドを入力し、Enter キーを押して Azure CLI にサインインします。

    ```
    az login
    ```

1.  表示されるブラウザー ウィンドウで、次の操作を実行します：
    
    1.  Microsoft アカウントの**電子メール アドレス**を入力します。
    
    1.  **次へ** を選択します。
    
    1.  Microsoft アカウントの**パスワード**を入力します。
    
    1.  **サインイン** を選択します。

1. 現在開いている**コマンド プロンプト**アプリケーションに戻ります。サインイン プロセスが完了するのを待ちます。

1. 次のコマンドを入力し、Enter キーを押して、**ManagedPlatform** リソース グループ内のすべての**アプリ**を一覧表示します。

    ```
    az webapp list --resource-group ManagedPlatform
    ```

1. 次のコマンドを入力し、Enter キーを押すと、プレフィックス **imgweb\** を持つ**アプリ**を見つけます。

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')]"
    ```

1. 次のコマンドを入力し、Enterキーを押すと、プレフィックス **imgweb\** を持つ単一のアプリの名前のみを印刷します。

    ```
    az webapp list --resource-group ManagedPlatform --query "[?starts_with(name, 'imgweb')].{Name:name}" --output tsv
    ```

1. 次のコマンドを入力し、Enter キーを押して現在のディレクトリを **すべてのファイル(F):\\Allfiles\\Labs\\02\\Starter\\Web** ディレクトリに変更するラボ ファイルを含みます。

    ```
    cd F:\Labfiles\02\Starter\Web\
    ```

1. 次のコマンドを入力し、Enter キーを押して、この実習ラボで前述の**Web アプリ**に**web.zip**ファイルをデプロイします。

    ```
    az webapp deployment source config-zip --resource-group ManagedPlatform --src web.zip --name <name-of-your-web-app>
    ```

    > **注記**: **\<name-of-your-web-app\>**を、この実習ラボで前に作成した Web アプリの名前に置き換えます。このアプリ名は、以前のステップで最近クエリしました。

1. この演習を進める前に、展開が完了するのを待ちます。

1. ポータルの左側のナビゲーション ペインで、**リソース グループ**を選択します。

1. **リソース グループ** ブレード で、この実習ラボで作成済みの**ManagedPlatform**リソース グループを選択します。

1. **ManagedPlatform** ブレードで、 この実習ラボで作成済みの**imgweb\** Web アプリを選択します。

1. **Web アプリ** ブレードで、**参照**を選択します。

1. ギャラリー内の画像の一覧を確認します。ギャラリーには、ラボの前半で Azure Storage にアップロードされた単一の画像が一覧表示されます。

1. **Contoso**フォト ギャラリーの Web ページの上部にある **新しい画像のアップロード**セクションを見つけて、次の操作を実行します。
    
    1.  **参照**を選択します。
    
    1.  開くファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images**に移動し、**bahnmi.jpg** ファイルを選択し、**開く**を選択します。
    
    1.  **アップロード**を選択します。

1. ギャラリー イメージの一覧が新しいイメージで更新されたことを確認します。

    > **注記**：まれに、新しいイメージを表示するためにブラウザー ウィンドウを更新する必要があります。

1. **Azure portal**を表示するブラウザ ウィンドウに戻ります。

#### 復習

この演習では、Azure Web アプリを作成し、既存の Web アプリケーションのコードをクラウド内のリソースにデプロイしました。

### エクササイズ 3: Azure Storage と Azure Functions を使用してバックグラウンド処理ジョブを構築する

#### タスク 1: フラッシュカード アプリを作成する

1.  Azure portalの左側のナビゲーション ペインで、**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある**マーケットプレースを検索**フィールドを検索します。

1.  検索フィールドで**機能**を入力し、'Enter」を押します。

1.  **すべて** 検索結果ブレードで、 **関数アプリ**の結果を選択します。

1.  **関数アプリ**ブレードで、**作成**を選択します。

1.  2番目の**関数アプリ** ブレードで、次の操作を実行します。
    
    1.  **アプリ名** フィールドに、**imgfunc\[*名前を小文字*\]**と入力します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** セクションで、**既存のを使用** を選択し、**マネージドプラットフォーム**を選択します。
    
    1.  **OS** セクションで、**Windows**を選択 します。
    
    1.  **ホスティング プラン** の一覧で、**消費プラン**を選択します。
    
    1.  **場所**リストで、**米国東部**リージョンを選択します。
    
    1.  **ランタイム スタック** リストで、**NET Core** を選択します。
    
    1.  **ストレージ** セクションで、**既存のものを使用**を選択し、この実習ラボで前に作成した**imgstor\**ストレージ アカウントを選択します。
    
    1.  **アプリケーションインサイト**フィールドを既定値に設定したままにします。
    
    1. **作成**を選択します。

1.  この演習を続行する前に、作成タスクが完了するのを待ちます。

#### タスク 2: .NET Core アプリケーション設定を作成する

1.  ポータルの左側にあるナビゲーション メニューで、**リソース グループ**リンクを選択します。

1.  **リソース グループ** ブレードで、 この実習ラボで作成済みの **ManagedPlatform** リソース グループを見つけて選択します。

1.  **ManagedPlatform** ブレードで、 この実習ラボで作成済みの**imgfunc\**関数アプリを選択します。

1.  **機能アプリ** ブレードで、**プラットフォームの機能**タブを選択します。

1.  **プラットフォームの機能**タブで、**一般設定**セクションにある **構成**リンクを選択 します。

1.  **構成**セクションで、次の操作を実行します：
    
    1.  [**アプリケーション設定**] タブを選択します。
    
    1.  [**+新しいアプリ設定**] を選択します。
    
    1.  表示される [**アプリケーションの追加/編集**] 設定 ポップアップで、[**名前**] フィールドに「**DOTNET_SKIP_FIRST_TIME_EXPERIENCE**」と入力します。
    
    1.  **値** フィールド に、**true**と入力します。

        > **注意**: ``DOTNET_SKIP_FIRST_TIME_EXPERIENCE`` アプリケーション設定は、組み込みの NuGet パッケージ キャッシュ メカニズムを無効にするように .NET Core に指示します。一時的なコンピューティング インスタンスでは、これは事実上時間の無駄となり、Azure Functions でビルドの問題が発生します。
    
    1.  **デプロイ スロット設定**フィールドを既定値のままにします。

    1.  [**OK**] を選択してポップアップを閉じ、[**構成**] セクションに戻ります。
    
    1.  ブレードの上部にある [**保存**] を選択して、設定を保持します。

1.  演習を進める前に、アプリケーションの設定が保持されるまで待ちます。

#### タスク 3: BLOBを処理する関数を作成する

1.  ポータルの左側のナビゲーション ペインで、**リソース グループ**を選択します。

1.  **リソース グループ** ブレードで、 この実習ラボで作成済みの**ManagedPlatform**リソース グループを見つけて選択します。

1.  **ManagedPlatform** ブレードで、 この実習ラボで作成済みの**imgfunc\**関数アプリを選択します。

1.  **機能アプリ** ブレードで、**+ 新機能**を選択します。

1.  **新しい Azure Function** のクイック スタートで、次のアクションを実行します。
    
    1.  **開発環境の選択** ヘッダーで、**ポータル内**を選択します。
    
    1.  **続行** を選択します。
    
    1.  **関数の作成** ヘッダーで、**その他のテンプレート**を選択します。
    
    1.  **テンプレートの終了と表示**を選択します。
    
    1.  **テンプレート** リストで、**Azure BLOB ストレージトリガ** を選択します。
    
    1.  **拡張機能がインストールされていない** ウィンドウで、**インストール**を選択します。

        > **注意**: Azure Storage BLOB の使用に必要な拡張機能のインストールには、最大2分かかる場合があります。ポータルが更新されない場合は、**インストールされていない拡張機能**ポップアップ ウィンドウを閉じて、もう一度**Azure BLOB ストレージトリガ**を選択します。

    1.  インストールが成功したら、**続行**を選択します。

    1.  **新機能** ウィンドウで、**名前**フィールドに **ImageManager**を入力します。

    1.  **新機能** ウィンドウで、**パス** フィールドに **images/{name}**を入力します。

    1. **新機能** ウィンドウで、**ストレージ アカウントの接続** の一覧で、**AzureWebJobsStorage**を選択します。

    1. **新機能** ウィンドウで、**作成**を選択します。

1.  関数エディタの右側で、**ファイルの表示**を選択してタブを開きます。

1.  **ファイルの表示** タブで、**追加**を選択します。

1.  表示されるファイル名ダイアログに **function.proj** と入力します。

1.  ファイル エディタで、次の構成コンテンツを挿入します。

    ```
    <Project Sdk="Microsoft.NET.Sdk">
        <PropertyGroup>
            <TargetFramework>netstandard2.0</TargetFramework>
        </PropertyGroup>
        <ItemGroup>
            <PackageReference Include="SixLabors.ImageSharp" Version="1.0.0-beta0006" />
        </ItemGroup>
    </Project>
    ```

1. エディタで **保存**ボタンを選択して、構成に対する変更を保持します。

    > **注記**: この **proj** ファイルには、[SixLabors.ImageSharp](https://www.nuget.org/packages/SixLabors.ImageSharp/1.0.0-beta0006) パッケージのインポートに必要な NuGet パッケージ参照が含まれています。
    
1.  **ファイルの表示**タブに戻り、**function.json**ファイルを選択 して、関数の構成のエディタを表示します。

1. JSONエディタで、現在の構成を確認します。

    ```
    {
      "bindings": [
        {
          "name": "myBlob",
          "type": "blobTrigger",
          "direction": "in",
          "path": "images/{name}",
          "connection": "AzureWebJobsStorage"
        }
      ],
      "disabled": false
    }
    ```

1. JSON 構成ファイルの内容全体を次の JSON コンテンツに置き換えます。

    ```
    {
      "bindings": [
        {
          "name": "inputBlob",
          "type": "blobTrigger",
          "direction": "in",
          "path": "images/{name}",
          "connection": "AzureWebJobsStorage"
        },
        {
          "type": "blob",
          "name": "outputBlob",
          "path": "images-thumbnails/{name}",
          "connection": "AzureWebJobsStorage",
          "direction": "out"
        }
      ]
    }
    ```

1. エディタで、**保存**を選択して、構成に対する変更を保持します。

1. **ファイルの表示** タブ で、**run.csx** ファイルを選択して、**ImageManager** 関数のエディタに戻ります。

1. **ファイルの表示**タブを最小化します。

    > **注記**：タブ ヘッダーのすぐ右にある矢印を選択して、タブを最小化できます。

1. 関数エディタで、関数スクリプトの例を確認します。

    ```
    public static void Run(Stream myBlob, string name, ILogger log)
    {
        log.LogInformation($"C# Blob trigger function Processed blob\n Name:{name} \n Size: {myBlob.Length} Bytes");
    }
    ```

1. サンプル コードをすべて**削除**します。

1. エディタ内で、次のプレースホルダ関数をコピーして貼り付けます。

    ```
    using SixLabors.ImageSharp;
    using SixLabors.ImageSharp.PixelFormats;
    using SixLabors.ImageSharp.Processing;
    using SixLabors.ImageSharp.Formats.Jpeg;
    using SixLabors.Primitives;
    
    public static void Run(Stream inputBlob, Stream outputBlob, string name, ILogger log)
    {
    }
    ```

1. **Save**を選択して、変更を保存し、コードをコンパイルします。

1. **Run**メソッド内に次のコード行を追加して、関数の実行に関する情報をログに記録します。

    ```
    log.LogInformation($"C# Blob trigger function Processed blob\n Name:{name} \n Size: {inputBlob.Length} Bytes");
    ```

1. 入力 BLOB の**Stream**をイメージ ライブラリに読み込むには、次の **using** ステートメントを追加します。

    ```
    using (Image<Rgba32> image = Image.Load(inputBlob))
    {
    }
    ```

1. **using** ステートメント内に次のコード行を追加して、イメージのサイズを変更し、グレースケール フィルタを適用してイメージを変更します。

    ```
    image.Mutate(i => 	
        i.Resize(new ResizeOptions { Size = new Size(250, 250), Mode = ResizeMode.Max }).Grayscale()
    );
    ```

1. 出力 BLOB の **Stream** に新しいイメージを保存するには、次のコード行を追加します。

    ```
    image.Save(outputBlob, new JpegEncoder());
    ```

1. **Run** メソッドは次のようになります。

    ```
    using SixLabors.ImageSharp;
    using SixLabors.ImageSharp.PixelFormats;
    using SixLabors.ImageSharp.Processing;
    using SixLabors.ImageSharp.Formats.Jpeg;
    using SixLabors.Primitives;
    
    public static void Run(Stream inputBlob, Stream outputBlob, string name, ILogger log)
    {
        log.LogInformation($"C# Blob trigger function Processed blob\n Name:{name} \n Size: {inputBlob.Length} Bytes");
        using (Image<Rgba32> image = Image.Load(inputBlob))
        {
            image.Mutate(i => 	
                i.Resize(new ResizeOptions { Size = new Size(250, 250), Mode = ResizeMode.Max }).Grayscale()
            );
            image.Save(outputBlob, new JpegEncoder());
        }
    }
    ```

1. **保存**を選択してスクリプトを保存し、コードを再度コンパイルします。

#### タスク 4: Web ソリューションの検証

1.  ポータルの左側のナビゲーション ペインで、**リソース グループ**を選択します。

1.  **リソース グループ**ブレードで、この実習ラボで作成済みの**ManagedPlatform** リソース グループを選択します。

1.  **ManagedPlatform** ブレードで、 この実習ラボで前に作成した**imgstor\**ストレージ アカウントを選択します。

1.  **ストレージ アカウント** ブレードで、ブレードの左側にある**BLOB サービス**セクションにおいて、**Containers** リンクを選択します。

1.  **Containers** セクションで、**イメージ** コンテナーを選択します。

1.  **コンテナ** ブレードで、**アップロード**を選択します。

1.  表示される **BLOB のアップロード** ウィンドウで、次の操作を実行します：

    1.  **ファイル** セクションで、**フォルダ**アイコンを選択します。

    1.  開くファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images**に移動し、**veggie.jpg** ファイルを選択し、**開く**を選択します。

    1.  **ファイルが既に存在する場合は上書き**チェックボックスがオンにチェックされていることを確認します。

    1.  **アップロード**を選択します。

1.  この演習を続行する前に、BLOB がアップロードされるのを待ちます。

1.  **コンテナ**ブレードを閉じます。

1. **Containers** セクションに戻り、**images-thumbnails** コンテナを選択します。

1. **コンテナ**ブレードで、**images-thumbnails** コンテナで新しく作成された **veggie.jpg** ファイルを確認します。

    > **注記**：新しいイメージが表示されるまでに1～5分かかる場合があります。

1. **images-thumbnails** コンテナで**veggie.jpg** BLOBを選択 します。

1. **BLOB** ブレードで、**BLOB の編集**タブを選択します。

1. BLOB のコンテンツを確認します。Web ページは、コンテナにアップロードされたイメージをレンダリングします。

1. ポータルの左側のナビゲーション ペインで、**リソース グループ**を選択します。

1. **リソース グループ**ブレードで、この実習ラボで作成済みの**ManagedPlatform** リソース グループを選択します。

1. **ManagedPlatform** ブレードで、 この実習ラボで作成済みの**imgweb\** Web アプリを選択します。

1. **Web アプリ** ブレードで、**参照**を選択します。

1. ギャラリー内の画像の一覧を確認します。サムネイルのリストを新しいサムネイル画像で更新する必要があります。

1. **Contoso フォト ギャラリー**のWeb ページの上部にある**新しい画像のアップロード**セクションを見つけて、次の操作を実行します。
    
    1.  **参照**を選択します。
    
    1.  開くファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images**に移動し、**blt.jpg** ファイルを選択し、**開く**を選択します。
    
    1.  **アップロード**を選択します。

1. **Contoso フォト ギャラリー**のWeb ページの上部にある**新しい画像のアップロード**セクションを見つけて、次の操作を実行します。
    
    1.  **参照**を選択します。
    
    1.  開くファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images** に移動し、**sub.jpg** ファイルを選択し、**開く**を選択します。
    
    1.  **アップロード**を選択します。

1. **Contoso フォト ギャラリー**のWeb ページの上部にある**新しい画像のアップロード**セクションを見つけて、次の操作を実行します。
    
    1.  **参照**を選択します。
    
    1.  開くファイル エクスプローラ ダイアログ ボックスで、**すべてのファイル (F):\\Allfiles\\Labs\\02\\Starter\\Images**に移動し、**burger.jpg** ファイルを選択し、**開く**を選択します。
    
    1.  **アップロード**を選択します。

1. ギャラリー イメージの一覧が新しいイメージで更新されたことを確認します。

1. ページ上部のサムネイルの一覧を確認します。サムネイルが生成されるまで、ページを1分ごとに更新します。

#### 確認

この演習では、イメージの変更とサイズ変更という計算負荷の高いタスクを処理するために、Azure Functionsでバックグラウンド処理ジョブを作成しました。

### エクササイズ 4: サブスクリプションのクリーンアップ 

#### タスク 1: Cloud Shell を開く

1.  ポータルの上部で、**Cloud Shell** アイコンを選択して新しいシェル インスタンスを開きます。

    > **注記**：**Cloud Shell** アイコンは、シンボルとアンダースコア文字より大きい文字で表されます。

1.  サブスクリプションを使用して初めて **Cloud Shell** を開く場合は、初めて使用する **Cloud Shell** を構成できる**Azure Cloud シェルへようこそウィザード**が表示されます。ウィザードで次の操作を実行します。
    
    1.  ダイアログボックスを表示すると、シェルを使用して開始する新しいストレージ アカウントを作成するよう求めるメッセージが表示されます。既定の設定を受け入れ、**ストレージの作成**を選択します。
    
    1.  **Cloud Shell** が初回のセットアップ手順を完了するのを待ってから、ラボを進めます。

    > **注記**: **Cloud Shell** の構成オプションが表示されない場合は、このコースの演習で既存のサブスクリプションを使用している可能性が高いと考えられます。演習は、新しいサブスクリプションを使用しているという推定から記述されます。

1.  ポータルの下部にある **Cloud Shell** コマンド プロンプトで次のコマンドを入力し、Enterキーを押してサブスクリプション内のすべてのリソース グループを一覧表示します。

    ```
    az group list
    ```

1.  次のコマンドを入力し、Enterキーを押して、リソース グループを削除する可能性のあるコマンドの一覧を表示します。

    ```
    az group delete --help
    ```

#### タスク 2: リソース グループを削除する

1.  次のコマンドを入力し、Enter キーを押して **ManagedPlatform** リソース グループを削除します。

    ```
    az group delete --name ManagedPlatform --no-wait --yes
    ```

1.  ポータルの下部にある **Cloud Shell** ペインを閉じます。

#### タスク 3: アクティブなアプリケーションを閉じる

1.  現在実行中の **Microsoft Edge** アプリケーションを閉じます。

1.  現在実行中の **Visual Studio Code** アプリケーションを閉じます。

#### 復習

この実習では、この演習で使用する **リソース グループ** を削除してサブスクリプションをクリーンアップしました。
