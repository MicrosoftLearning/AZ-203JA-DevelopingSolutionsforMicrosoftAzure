---
lab:
    title: 'ラボ: Azure のサービスを使用して多層ソリューションを作成する'
    type: 'Answer Key'
    module: 'モジュール 6: 接続して Azure を使用する、サード パーティのサービス'
---

# ラボ: Azure のサービスを使用した多層ソリューションの作成
# 受講者ラボ解答キー

## Microsoft Azure ユーザー インターフェイス

Microsoft クラウド ツールのダイナミックな性質を考えると、このトレーニング コンテンツの開発後に Azure ユーザー インターフェイス (UI) の変更が発生する可能性があります。これらの変更により、ラボの指示と手順が一致しない場合があります。

Microsoft ワールドワイド ラーニング チームは、コミュニティが必要な変更を行うとすぐに、このトレーニング コースを更新します。しかし、クラウド更新が頻繁に起きるため、この研修内容が更新される前に、UI の変更を経験するかも知れません。**その場合は変更に順応して、必要に応じてラボでをそれを処理してください。**

## 指示

### 開始する前に

#### ラボの仮想マシンへのサインイン

次の認証情報を使用して **Windows 10** 仮想マシンにサインインします。
    
-   **ユーザー名**：Admin

-   **パスワード**: Pa55w.rd

> **注記**：ラボ仮想マシンのサインイン手順は、インストラクターから提供されます。

#### インストールされたアプリケーションの検討

**Windows 10** デスクトップの下部にあるタスク バーを確認します。タスク バーには、このラボで使用するアプリケーションのアイコンが含まれています。
    
-   Microsoft Edge

-   エクスプローラ

-   Azure Storage Explorer をインストールする

#### 練習用ファイルをダウンロードする

1.  タスク バーで、**Windows PowerShell** アイコンを選択します。

1.  PowerShell コマンド プロンプトで、現在の作業ディレクトリを **Allfiles (F):\\** パスに変更します。

    ```
    cd F:
    ```

1.  コマンド プロンプト内で次のコマンドを入力し、Enter キーを押して、GitHub でホストされている **microsoftlearning/AZ-203-DevelopingSolutionsforMicrosoftAzure** プロジェクトを  **Allfiles (F):\\* ドライブにクローンします。

    ```
    git clone --depth 1 --no-checkout https://github.com/microsoftlearning/AZ-203-DevelopingSolutionsForMicrosoftAzure .
    ```

1.  コマンド プロンプト内で次のコマンドを入力し、**Enter** キーを押 して、**AZ-203T06** ラボを完了するために必要なラボ ファイルをチェックアウトします。

    ```
    git checkout master -- Allfiles/*
    ```

1.  現在実行中の **Windows PowerShell** コマンド プロンプト アプリケーションを閉じます。

### エクササイズ 1: ポータルで Azure Search Serviceを作成する

#### タスク 1: Azure portal を開く

1.  タスク バーで、**Microsoft Edge** アイコンを選択します。

1.  開いているブラウザ ウィンドウで、[**Azure portal**](https://portal.azure.com)(portal.azure.com)に移動します。

1.  サインイン ページで、Microsoft アカウントの **電子メール アドレス**を入力します。

1.  **次へ** を選択します。

1.  Microsoft アカウントの**パスワード**を入力します。

1.  **サインイン** を選択します。

    > **注記**：**Azure portal** に初めてサインインする場合は、ポータルのツアーを提供するダイアログ ボックスが表示されます。ツアーをスキップしてポータルの使用を開始するには、**開始**を選択します。

#### タスク 2: API Management リソースの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある **マーケットプレースを検索** フィールドを検索します。

1.  検索フィールドに **API** を入力し、Enter キーを押します。

1.  **すべての** 検索結果] ブレードで、**API Management **結果を選択します。

1.  **API Ｍａｎａｇｅｍｅｎｔ** ブレードで、**作成**を選択 します。

1.  **API Ｍａｎａｇｅｍｅｎｔ サービス**ブレードで、次のアクションを実行します。
    
    1.  **名前**フィールドに、 **prodapi\[*小文字*\]**と入力します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** の一覧で、**マルチ層サービス **を選択します。
    
    1.  **場所**リストで、**米国東部**リージョンを選択します。
    
    1.  **組織名** フィールドに**Contoso**と入力します。
    
    1.  **管理者の電子メール**フィールドを既定値に設定したままにします。
    
    1.  **価格層**ボックスの一覧で、**開発者 (SLA なし)**を選択します。
    
    1.  **作成** を選択します。

1.  演習を進める前に、作成タスクが完了するまで待ちます。

    > **注記**：通常、API Management サービスの作成には 20 、 30 分かかります。

#### タスク 3: Azure Search アカウントを作成する

1.  ポータルの左側のナビゲーション ウィンドウで、**+ リソースを作成**を選択します。

    > **注記**：リンクが見つからない場合は、リソースの作成 アイコンは、ポータルの左側にあるプラス記号文字です。

1.  **新規**ブレードの上部にある **マーケットプレースを検索** フィールドを検索します。

1.  検索フィールドに**検索**というテキストを入力し、Enter」を押します。

1.  ［**すべて** の検索結果］ ブレードで、Azure **検索** 結果 を選択します。

1.  **Azure 検索** ブレードで、**作成** を選択 します。

6.  **新規 Search Service**ブレードで、**基本**などのブレードの上部にあるタブを確認します。

    > **注記**: 各タブは、ワークフロー内の新しい**アカウントの検索**を作成するためのステップを表 します。いつでも**レビュー + 作成**を選択して、残りのタブをスキップできます。

6.  **基本**タブで、次の操作を実行します：
    
    2.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    3.  **リソース グループ** セクションで、**新規作成 **を選択し、**MultiTierService** を選択し、**OK **を選択します。
    
    1.  **URL** フィールドに、値 **prodsearch\[*名前を小文字*\] と**入力します。
    
    4.  **場所**リストで、**米国東部**リージョンを選択します。
    
    5.  **価格設定**リンクを選択します。**価格設定** ブレードで**基本** を選択し、**選択**を選択します。
    
    9.  **レビュー + 作成**を選択します。

7.  **レビュー + 作成**タブで、前の手順で選択したオプションを確認します。

8.  指定した構成を使用して検索アカウントを作成するには、**作成**を選択します。

9.  演習を進める前に、作成タスクが完了するまで待ちます。

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService**  リソースグループを選択します。

1. **MultiTierService** ブレードで、この実習ラボで前に作成した **prodsearch\** 検索サービスを選択します。

1. **検索サービス** ブレードで、**設定**セクションで**キー**リンクを選択します。

1. **キー**セクションで、いずれかのキーを選択し、値を記録します。これらの値は、この演習の後半で使用します。

    > **注記**：使用を選択する接続文字列は関係ありません。それらは交換可能です。

#### タスク 4: インデックスの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、この実習ラボで前に作成した **prodsearch\** 検索サービスを選択します。

1.  **検索サービス** ブレードで、**インデックスの追加 **を選択します。

1.  **インデックスの追加**ブレードで、次の操作を実行します。
    
    1.  **インデックス名** フィールドに、**小売** と入力します。
    
    1.  **キー]** リストで **ID]** を選択します。
    
    1.  **提案者名**フィールドは空白のままにします。
    
    1.  **検索モード**の一覧は空白のままにします。

1.  **インデックスの追加]**ブレード内に、フィールドの一覧が表示されます。次のアクションを実行して、**ID** フィールドを構成 します。
    
    1.  **フィールド名** フィールドで、**ID** のハードコーディングされた値を確認します。
    
    1.  **タイプ** リストで、**Edm.String** のハードコーディングされたオプションを確認します。
    
    1.  **取得可能** オプションで、それが **true** にハードコーディングされていることに注意してください。
    
    1.  **フィルタ可能**を選択しないままにします。
    
    1.  **ソート可能**を選択します。
    
    1.  **フェイステーブル**を選択解除したままにします。
    
    1. **検索可能**を選択しないままにします。

    1. **＋ フィールドの追加** を選択します。

1.  **インデックスの追加**ブレード内で、 次の操作を実行して、新しい **名前**フィールドを構成します。
    
    1. **＋ フィールドの追加** を選択します。
    
    1. **フィールド名** フィールドに **名前**を入力します。
    
    1. **種類** リストで、**Edm.String** を選択します。
    
    1. **取得可能**を選択します。
    
    1. **フィルタ可能**を選択しないままにします。
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択解除したままにします。
    
    1. **検索可能**を選択します。
    
    1. **分析** の一覧で、**標準 - ルセン**を選択します。

    1. **＋ フィールドの追加** を選択します。

1.  **インデックスの追加** ブレードで、次のアクションを実行して、新しい **価格**フィールドを選択します。
    
    1. **＋ フィールドの追加** を選択します。
    
    1. **フィールド名** フィールドに**価格**を入力します。
    
    1. **種類** リストで **仕事仲間** を選択します。
    
    1. **取得可能**を選択します。
    
    1. **フィルター可能** を選択する
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択します。

    1. **＋ フィールドの追加** を選択します。

1.  **インデックスの追加** ブレードで、次のアクションを実行して、新しい **数量**フィールドを構成します。
    
    1. **＋ フィールドの追加** を選択します。
    
    1. **フィールド名** フィールドに**数量**を入力します。
    
    1. **種類** リストで **Edm.Int32** を選択します。
    
    1. **取得可能**を選択します。
    
    1. **フィルター可能** を選択する
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択します。

    1. **＋ フィールドの追加** を選択します。

1. **インデックスの追加** ブレードで、次の操作を実行して、新しい **製造元**フィールドを構成します。
    
    1. **＋ フィールドの追加** を選択します。
    
    1. **フィールド名** フィールドに **製造元**を入力します。
    
    1. **種類** リストで **Edm.String** を選択します。
    
    1. **取得可能**を選択します。
    
    1. **フィルター可能** を選択する
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択します。
    
    1. **検索可能**を選択しないままにします。

1. **インデックスの追加** ブレードで、**作成**を選択 します。

#### 復習

この演習では、新しい Azure Search アカウントを作成し、アカウント内にインデックスを作成しました。

### エクササイズ 2: Azure 検索で Azure Storage テーブルのインデックスを作成する

#### タスク 1: Azure Storage  アカウントを作成する

1.  ポータルの左側のナビゲーション ウィンドウで、**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある **マーケットプレースを検索** フィールドを検索します。

1.  検索フィールドで**ストレージ」**を入力し、Enterを押します。

1.  **すべて** 検索結果] ブレードで、**ストレージ アカウント**の結果 を選択します。

1.  **ストレージ アカウント** ブレードで、**作成]**を選択 します。

1.  **ストレージ アカウントを作成**ブレードで、ブレードの上部にあるタブを確認します。

    >  **注記**：各タブは、ワークフロー内の新しい**ストレージ アカウント**を作成するためのステップを表 します。いつでも**レビュー + 作成**を選択して、残りのタブをスキップできます。

1.  **基本**タブで、次の操作を実行します：
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** の一覧で、**マルチ層サービス **を選択します。
    
    1.  **ストレージ アカウント名** フィールドに、**prodstorage\[*小文字で名前を入力*\]** と入力します。
    
    1.  **場所**リストで、**(US) 米国東部**リージョンを選択します。
    
    1.  **パフォーマンス** セクションで、**標準**を選択します。
    
    1.  **アカウントの種類** の一覧で、**StorageV2(汎用 v2)**を選択します。
    
    1.  **レプリケーション** リストで、 **Read-access geo-redundant storage ストレージ (RA-GRS)** を選択します。
    
    1.  **アクセス層** セクションで、**Hot**が選択されていることを確認します。
    
    1.  **レビュー + 作成**を選択します。

1.  **レビュー + 作成**タブで、前の手順で入力したオプションを確認します。

1.  指定した構成を使用してストレージ アカウントを作成するには、**作成**を選択します。

1. 演習を進める前に、作成タスクが完了するまで待ちます。

1. ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択します。

1. **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService**  リソースグループを選択します。

1. **MultiTierService** ブレードで、 この実習ラボで前述した **prodstorage\** ストレージ アカウントを選択します。

1. **ストレージ アカウント** ブレードの左側にある **設定**セクションで、**アクセス キー**リンクを選択します。

1. **アクセス キー** ブレードで、いずれかのキーを選択し、いずれかの**接続文字列**フィールドの値を記録します。これらの値は、この演習の後半で使用します。

    > **注記**：どの接続文字列を選択しても問題ありません。それらは交換可能です。

#### タスク 2: Azure Storage にテーブルエンティティをアップロードする

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、 この実習ラボで前述した **prodstorage\** ストレージ アカウントを選択します。

1.  **ストレージ アカウント** ブレードで、ブレードの左側にある **テーブル サービス**セクションで、**テーブル**リンクを選択します。

1.  **テーブル** グループで、**＋テーブル** を選択します。

1.  **テーブルの追加**ウィンドウで、次の操作を実行します。
    
    1.  **テーブル** **名** フィールドに**製品**を入力 します。
    
    1.  **OK** を選択します。

1.  **テーブル**セクションに戻 り、 ブレードの左側にある **概要**リンクを選択します。

    > **注記**：ブレードの左側にあるメニューを上下にスクロールする必要がある場合があります。

1.  **概要** セクションに戻り、**エクスプローラで開く**を選択します。

1.  **Azure Storage Explorer** ウィンドウで、**Azure Storage Explorerを開く** リンクを選択します。

    > **注記**：ポータルを使用して**Azure Storage Explorer**を初めて開く場合 は、今後、ポータルでこれらの種類のリンクを開くことを許可するように求めるメッセージが表示されることがあります。プロンプトを受け入れる必要があります。

1. 表示される **Azure Storage Explorer** アプリケーションで、このラボで前に作成した **prodstorage\* **Storage アカウントを見つけて展開します。

1. **prodstorage\** ストレージ アカウント内で、**テーブル**ノードを見つけて展開します。

1. **[テーブル]** ノードで、この演習で前に作成した**製品**テーブルを選択します。

1. **[製品テーブル]** タブで、**[インポート]**を選択します。

1. **[エクスプローラを開く]**ダイアログボックスで、次の操作を実行します。
    
    1.  **Allfiles (F):\\Allfiles\\Labs\\06\\Starter** に移動します。
    
    1.  **products.csv** というファイルを選択します。
    
    1.  **[開く]** を選択します。

1. **[エンティティのインポート]** ウィンドウで、**[挿入]**を選択 します。

1. この演習を続行する前に、テーブルエンティティがアップロードされるのを待ちます。

1. **製品**テーブルに追加された 5 つのエンティティを確認します。

1. **Azure portal**を示すブラウザ ウィンドウに戻ります。

#### タスク 3: Azure Search インデクサーの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、 この実習ラボで前に作成した **prodsearch\** 検索サービスを選択します。

1.  **検索サービス** ブレードで、**データのインポート**を選択 します。

1.  **データのインポート**ブレードで、ブレードの上部にあるタブを確認します。

1.  **データに接続**タブで、次の操作を実行します：
    
    1.  **データ ソース** リストで、**Azure テーブルストレージ**を選択 します。
    
    1.  **名前** フィールド に、**テーブルデータソース**を入力します。
    
    1.  **接続文字列** フィールドで、**既存の接続を選択** を選択します。**ストレージ アカウントの選択**ウィンドウで、  この実習ラボで前に作成した**prodstorage\**ストレージ アカウントを選択します。
    
    1.  **テーブル名** フィールドに**製品**を入力 します。
    
    1.  **クエリ**フィールドは空のままにします。
    
    1.  **説明**フィールドは空のままにします。
    
    1.  **次へ**を選択します:** Cognitive Search を追加します (オプション)**。

        > **注意**: Azure Search は、各ステップで設定を検証します。検証が完了し、リスト内の次のタブに移動するまでに数分かかる場合があります。

1.  **Cognitive Search の追加** タブで、次を**省略**します。**ターゲット インデックスのカスタマイズに進む**。

1.  **ターゲットインデックスのカスタマイズ**タブで、次の操作を実行します：
    
    1.  **インデックス名** フィールドに**RowKey**を入力 します。
    
    1.  **キー** リストで **RowKey** を選択します。

1.  **ターゲットインデックスのカスタマイズ**タブに、フィールドの一覧が表示されます。**パーティショキー**、**RowKey**、**ETag**、および**タイムスタンプ**フィールドの構成は規定値に設定したままにします。

1. **ターゲット インデックスのカスタマイズ**タブ で、次の操作を実行して**キー**フィールドを構成します。
    
    1. **フィールド名** フィールドで、**キー**のハードコーディングされた値を確認 します。
    
    1. **タイプ** リストで、**Edm.String** のハードコーディングされたオプションを確認します。
    
    1. **取得可能**を選択したままにします。 
    
    1. **フィルタ可能**を選択しないままにします。
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択解除したままにします。
    
    1. **検索可能**を選択しないままにします。

1. **ターゲット インデックスのカスタマイズ**タブ で、**名前**フィールドを構成するために次のアクションを実行します。
    
    1. **フィールド名** フィールドで、**名前**のハードコーディングされた値を確認します。
    
    1. **タイプ** リストで、**Edm.String** のハードコーディングされたオプションを確認します。
    
    1. **取得可能**を選択します。
    
    1. **フィルタ可能**を選択しないままにします。
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択解除したままにします。
    
    1. **検索可能**を選択します。
    
    1. **分析** の一覧で、**標準 - ルセン**を選択します。

1. **ターゲット インデックスのカスタマイズ タブ** で、次のアクションを実行して**価格**フィールドを構成します。
    
    1. **フィールド名** フィールドで、**価格**のハードコーディングされた値を確認します。
    
    1. **タイプ** リストで、 **Edm.Double** のハードコーディングされたオプションを確認 します。
    
    1. **取得可能**を選択します。
    
    1. **フィルター可能** を選択する
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択します。

1. **ターゲット インデックスのカスタマイズ** タブで、次のアクションを実行して **数量**フィールドを構成します。
    
    1. **フィールド名** フィールドで、**数量**のハードコーディングされた値を確認します。
    
    1. **タイプ**リストで、**Edm.Int32** のハードコーディングされたオプションを確認します。
    
    1. **取得可能**を選択します。
    
    1. **フィルター可能** を選択する
    
    1. **ソート可能**を選択します。
    
    1. **フェイステーブル**を選択します。

1. **ターゲット インデックスのカスタマイズ**タブで、**次へ**を選択します:** インデクサーを作成**

    > **注記**：Azure Search は、各ステップで設定を検証します。検証が完了し、リスト内の次のタブに移動するまでに数分かかる場合があります。

1. **インデクサーを作成**タブで、次の操作を実行します：
    
    1. **名前** フィールドに、**テーブルインデックス**を入力します。
    
    1. **スケジュール**セクションで、**カスタム**を選択します。
    
    1. **間隔**フィールドに  **5** と入力します。
    
    1. 今日の日付の [**開始時刻**] フィールドを午前 0 時 (UTC) に設定します。 
    
    1. **トラック削除**フィールドは既定値に設定したままにします。
    
    1. **説明**フィールドは空白のままにします。
    
    1. **送信** を選択します。

        > **注意**: [**送信**] ボタンを表示するには、[**削除のトレース**] フィールドと [**1 回/カスタム**] オプションを選択してオフにする必要がある場合があります。   これは、ポータルのバグが原因です。

1. **検索サービス**ブレードに戻り、**インデクタ**タブを選択します。

    > **注記**: インデクサーがまだ表示されない場合は、ブレードを更新する必要があります。

1. **インデクサー** タブで、 この実習ラボで前に作成した**テーブルインデクサー** インデクサーを選択します。

1. **インデクサー**ブレードで、次の操作を実行します。
    
    1. **実行** を選択します。
    
    1. 確認を求めるメッセージが表示されたら、**Yes** をクリックします。
    
    1. **インデクサー**ブレードを閉じます。

1. インデクサーの実行が完了するのを待ってから、 ブレードの上部にある**更新**を選択します。

    > **注記**：インデクサーが実行されるのに 1 から 5 分かかる場合があります。インデクサーのステータスが**検索サービス**ブレードに**成功**と表示されている場合は、インデクサーが成功したことがわかります。

1. **インデクサー** タブで、 ドキュメント数や最後のインデックス作成操作の状態など、**テーブルインデクサー** インデクサーのメタデータを確認します。

#### タスク 4: インデックス化した表データを確認します

1.  **Search Service** ブレードで、ブレードの上部にある**Explorer の検索**を選択します。

1.  **エクスプローラの検索**ブレードで、**検索**を選択します。

1.  すべてのドキュメントの検索結果を確認します。

1.  **クエリ文字列** フィールドに次のクエリを入力し、**検索** を押します。

    ```
    search=seat
    ```

1.  検索クエリの結果を確認します。

1.  **クエリ文字列** フィールドに次のクエリを入力し、**検索** を押します。

    ```
    $filter=price lt 100
    ```

1.  検索クエリの結果を確認します。

1.  **クエリ文字列** フィールドに次のクエリを入力し、**検索** を押します。

    ```
    facet=quantity,interval:25
    ```

1.  検索クエリの結果を確認します。

1. **クエリ文字列** フィールドに次のクエリを入力し、**検索** を押します。

    ```
    $filter=quantity gt 25&facet=price,values:100|1000|10000
    ```

1. 検索クエリの結果を確認します。

1. [**Explorer の検索**] ブレードを閉じます。 

#### タスク 5: Azure Search ベース URL を取得する

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、この実習ラボで前に作成した **prodsearch\** 検索サービスを選択します。

1.  **検索サービス** ブレードで、**URL** フィールドの値をコピー します。これらの値は、この演習の後半で使用します。

#### 復習

この演習では、Azure Storage アカウントを作成し、Azure Search を使用してアカウント内のストレージ テーブルにインデックスを作成しました。表がインデックス化された後、Storage 表のエンティティ―のコピーに対して検索クエリを発行することができました。

### エクササイズ 3: Azure API Management を使って、ＡＰＩ プロクシー層を構築

#### タスク 1: 新しい API の定義

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、 この実習ラボで前に作成した**prodapi\** API Management アカウントを選択します。

1.  **API Management サービス** ブレードで、ブレードの左側にある** API Management** セクションで **API**を選択 します。

1.  **[新しい API を追加]** セクションで、**[空白 API]**を選択します。

1.  **[空白の API を作成する]**ウィンドウで、次のアクションを実行します。
    
    1.  **[名前の表示]** フィールドに**検索 API** を入力 します。
    
    1.  **[名前]** フィールドに、**検索 api** を入力します。
    
    1.  **[Web サービスの URL]** フィールドに、 この実習ラボで前にコピーした**[検索サービス URL]** フィールドのURL を入力します。
    
    1.  **Web サービス URL** フィールドの値を次の相対 URL で追加します。

    ```
    /indexes/products/docs
    ```

    > **注記**: たとえば、Web サービスの URL が https://prodsearchstudent.search.windows.net 場合、新しい URL は https://prodsearchstudent.search.windows.net/indexes/products/docs になります。

1.  **API URL サフィックス** フィールドに、**［検索］**を入力 します。

1.  **製品** フィールドで、**スターター** と **無制限**の両方を選択します。

1.  **作成** を選択します。

1.  新しい API の作成が完了するのを待ちます。

1.  **デザイン** タブで、**+ 追加操作**を選択します。

1.  **操作の追加**セクションで、次の操作を実行します。
    
    1.  **名前の表示** フィールド に、**すべてのドキュメントの一覧**を入力します。
    
    1.  **名前** フィールドに、 **すべてのドキュメントの一覧**を入力します。
    
    1. **URL** リストで **GET** を選択します。
    
    1. **URL**フィールドに、 **/**を入力します。
    
    1. **保存**を選択します。

1. **デザイン**タブに戻 り、 操作の一覧で**すべての操作**を選択 します。

1. **すべての操作**の**設計**セクション で、 **受信処理**タイルを検索し、**+ ポリシーを追加**を選択します。

1. **受信ポリシーの追加** セクションで、**ヘッダーの設定**タイルを選択します。

1. **入庫処理**セクションでは、次のアクションを実行します。
    
    1. **名前** フィールドに、**api キー**を入力します。
    
    1. **値** フィールドで、リストを選択し、**+ 付加価値**を選択し、この実習ラボで前に記録した**検索サービス キー**の値を入力します。
    
    1. **アクション** リストで、 **オーバーライド**オプションを選択します。
    
    1. **保存**を選択します。

1. **デザイン**タブに戻 り、 操作の一覧で**すべての操作**を選択 します。

1. **すべての操作**の**設計**セクション で、 **受信処理**タイルを検索し、**+ ポリシーを追加**を選択します。

1. **受信ポリシーの追加** セクションで、**クエリ パラメータの設定**タイルを選択します。

1. **着信処理、クエリ パラメータ**セクションでは、次のアクションを実行します。
    
    1. **名前** フィールドに、**api-version** を入力します。
    
    1. **値** フィールド に、**2017-11-11**と入力します。
    
    1. **アクション** リストで **オーバーライド** を選択します。
    
    1. **保存**を選択します。

1. **デザイン**タブに戻る操作の一覧で、**すべてのドキュメントの一覧**を選択します。

1. **すべてのドキュメントの一覧**操作の**デザイン**セクションで、**受信処理**タイルを検索 し、**+ ポリシーを追加**ボタンを選択します。

1. **受信ポリシーの追加** セクションで、**クエリ パラメータの設定**タイルを選択します。

1. **着信処理、クエリ パラメータ**セクションでは、次のアクションを実行します。
    
    1. **名前**フィールドに、**[検索]**を入力します。
    
    1. **値**フィールドに**\*** と入力します。
    
    1. **アクション** リストで **オーバーライド** を選択します。
    
    1. **保存**を選択します。

1. **デザイン**タブに戻る操作の一覧で、**すべてのドキュメントの一覧**を選択します。

1. **テスト** タブを選択します。

1. **すべてのドキュメントの一覧**操作を選択します。

1. **すべてのドキュメントの一覧** セクションで、**送信**を選択します。

1. API 要求の結果を確認します。

    > **注記**：応答に大量の Azure Search メタデータがあることを確認します。API ユーザーに、バックグラウンドで発生する実装の詳細を知られたくない場合があります。次のタスクでは、このデータの大部分を難読化します。

1. 操作の一覧に戻る **デザイン** タブを選択します。

#### タスク 2: API 応答の操作

1.  **デザイン**タブに戻る  操作の一覧で、**すべてのドキュメントの一覧**を選択します。

1.  **すべてのドキュメントの一覧** 操作の**デザイン**セクション で、**送信処理**タイルを検索し、**+ ポリシーを追加**を選択します。

1.  **送信ポリシーの追加** セクションで、**その他のポリシー**タイルを選択します。

1.  ポリシー コード エディターで、次の XML コンテンツのブロックを見つけます。

    ```
    <outbound>
        <base />
    </outbound>
    ```

1. Replace that block of XML with the following XML:

    ```
    <outbound>
        <base />
        <set-body>
        @{ 
            var response = context.Response.Body.As<JObject>();
            return response.Property("value").Value.ToString();
        }
        </set-body>
    </outbound>
    ```

1.  ポリシー コード エディタで、**保存**を選択 します。

1.  **デザイン**タブに戻る操作の一覧で、**すべてのドキュメントの一覧**を選択します。

1.  **すべてのドキュメントの一覧** 操作の**デザイン**セクション で、**送信処理**タイルを検索し、**+ ポリシーを追加**を選択します。

1.  **送信ポリシーの追加** セクションで、**ヘッダーの設定**タイルを選択します。

1.  **送信処理**セクションでは、次のアクションを実行します。
    
    1.  **名前**フィールドに、**プレファランス設定が適用済み**と入力します。
    
    1.  **アクション**リストで **削除** を選択します。
    
    1.  Select **+** **ヘッドの追加**.
    
    1.  新しい **名前** フィールドに、**odata バージョン**を入力します。
    
    1.  新しい**アクション** リストで、**削除**を選択します。
    
    1.  **＋ ヘッドの追加** を選択します。
    
    1.  新しい **名前** フィールドに、**電源付き**と入力します。
    
    1.  新しい **値** フィールドで、一覧を選択し、**+ 値の追加**リンクを選択 し、**Contoso** を入力します。
    
    1.  新しい **アクション** リストで、**オーバーライド**を選択します。
    
    1. **保存**を選択します。

1. **デザイン**タブに戻る操作の一覧で、**すべてのドキュメントの一覧**を選択します。

1. **テスト** タブを選択します。

1. **すべてのドキュメントの一覧**操作を選択します。

1. **すべてのドキュメントの一覧** セクションで、**送信**を選択します。

1. API 要求の結果を確認します。

    > **注記**：**指定したプリファレンス適用** ヘッダーと **odata バージョン** ヘッダーが削除され、新しい**電源付き**ヘッダーに置き換えられている ことがわかります。また、応答には OData 応答に関するコンテキスト データが含まれておらず、応答本文としてフラット化された JSON 配列が含まれていることも確認してください。

#### 復習

この演習では、Azure Search アカウントと検索クエリを実行する開発者の間にプロキシ階層を構築しました。

### エクササイズ 4: Azure Logic Apps を使用して新しいテーブル エンティティを作成する

#### タスク 1: Logic アプリ リソースの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**+ リソースを作成**を選択します。

1.  **新規**ブレードの上部にある **マーケットプレースを検索** フィールドを検索します。

1.  検索フィールドで、 **ロジック**を入力し、Enter キーを押します。

1.  [**すべて** 検索結果] ブレードで、**ロジック アプリの結果** を選択します。

1.  **ロジック アプリ** ブレードで、**作成** を選択します。

1.  **ロジック アプリ**ブレードで、次の操作を実行します。
    
    1.  **名前**フィールド に、**prodworkflow\[*小文字*\]**と入力します。
    
    1.  **サブスクリプション**フィールドは既定値に設定したままにします。
    
    1.  **リソース グループ** セクションで、**既存の使用**を選択し、 一覧から**マルチ層サービス**オプションを選択します。
    
    1.  **場所**リストで、**米国東部**リージョンを選択します。
    
    1.  **ログ分析** セクションで、**オフ**を選択します。
    
    1.  **作成**を選択します。

1.  演習を進める前に、作成タスクが完了するまで待ちます。

#### タスク 2: Logic アプリのワークフロー用トリガーの作成

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、 この実習ラボで前に作成した **prodworkflow\** ロジック アプリを選択します。

1.  **ロジック アプリ デザイナ** ブレードで、 **空白のロジック アプリ**テンプレートを選択します。

1.  **デザイナ**領域で、**HTTP トリガー**を追加するには、次のアクションを実行します。
    
    1.  **コネクタとトリガー**フィールドに**HTTP** と入力します。
    
    1.  **トリガー結果** ボックスの一覧で、**HTTP 要求を受信した場合**を選択します。
    
    1.  スキーマを生成するには、**サンプル ペイロードを使用する**を選択します。
    
    1.  **サンプル JSON ペイロード ウィンドウの入力または貼り付け**で、次の JSON オブジェクトを入力します。

    ```
    { 
        "id": "",
        "manufacturer": "",
        "price": 0.00,
        "quantity": 0,
        "name": ""
    }
    ```

1.  **完了**を選択します。

1.  **要求本文 JSON スキーマ**フィールドでスキーマを確認します。このスキーマは、前の手順で入力した JSON コンテンツに基づいて Azure によって自動的に作成されます。

#### タスク 3: Azure Storage 用コネクターの構築

1.  **デザイナ**領域で、**+ 新しいステップ**を選択します。

1.  **デザイナー**領域で、次のアクションを実行して、 **エンティティの挿入または置換アクション**を追加します。
    
    1.  **コネクターとトリガー** フィールドに**テーブル**と入力 します。
    
    1.  カテゴリ リストで、**Azure テーブルストレージ**を選択します。
    
    1.  **アクション**結果] リストで、**エンティティの挿入または置換**を選択します。
    
    1.  **接続名** フィールドに、 **テーブル接続**を入力します。
    
    1.  **ストレージ アカウント** セクションで、 この実習ラボで前に作成した **prodstorage\** ストレージ アカウントを選択します。
    
    1.  **作成** を選択します。
    
    1.  コネクタ リソースの作成が完了するのを待ちます。

        > **注意**: これらのリソースの作成には 1 から 5 分かかります。

1.  **テーブル** リストで **製品** を選択します。

1.  **パーティション キー** フィールドの右側 にある **動的コンテンツ** ウィンドウで、** HTTP 要求を受信した場合** カテゴリ内で、**製造元**を選択します。

1. **RowKey**フィールドの右側にある **動的コンテンツ** ウィンドウで、 **HTTP 要求を受信した場合**カテゴリ内で、 **id** を選択します。

1. **エンティティー**フィールドの 右側 にある **動的コンテンツ** ウィンドウで、 **HTTP 要求を受信した場合 カテゴリ内で** 、**本文**を選択します。

#### タスク 4: HTTP 応答アクションの構築

1.  **デザイナー**領域で、**+ 新しいステップ**を選択します。

1.  **デザイナー**領域で、次のアクションを実行して、**応答アクション**を追加します。
    
    1.  **コネクターとトリガーを検索** フィールドで、**応答**と入力します。
    
    1.  **アクション結果** ボックスの一覧で、**応答** を選択します。
    
    1.  **ステータスコード**フィールドに  **201** と入力します。
    
    1.  **本文**フィールドの右側にある **動的コンテンツ** ウィンドウで、**エンティティの置換 **カテゴリ内で **本文** を選択します。

#### タスク 5: HTTP トリガー POST URL の取得

1.  **デザイナー**領域で、**保存**を選択します。

1.  ワークフローが保存されると、 **HTTP 要求を受信した場合**の **HTTP POST URL** フィールドが新しい URL で更新され、このワークフローを開始する必要があります。**HTTP POST URL** フィールドに URL をコピー します。この URL は、この演習の後半で使用します。

    > **注記**：SAS トークンを持った URL を含むため、これは非常に長い URL となります。確実に URL 全体をコピーしてください。

#### タスク 6: ロジック アプリの結果がインデックス化されていることを確認してください。

1.  ポータルの上部で、**Cloud Shell** アイコンを選択して新しいシェルインスタンスを開きます。

    > **注記**：**Cloud Shell** アイコンは、シンボルとアンダースコア文字より大きい文字で表されます。

1.  サブスクリプションを使用して初めて**Cloud Shell** を開く場合  は、 **Azure Cloud Shell へようこそ**で、初めて使用する** Cloud Shell** を構成する方法が表示されます。以下のアクションを非表示にします：
    
    1.  **Bash** または**PowerShell** の間で選択が行われた場合は、**[Bash]** を選択します。
    
    1.  ダイアログボックスを表示すると、シェルを使用して開始する新しいストレージ アカウントを作成するよう求めるメッセージが表示されます。既定の設定を受け入れ、**ストレージの作成**を選択します。
    
    1.  **Cloud Shell**が初回セットアップ手順を完了するのを待ってから、ラボを進めます。

        > **注意**: **Cloud Shell**の構成オプションが表示されない場合は、このコースのラボで既存のサブスクリプションを使用している可能性が高いと考えられます。演習は、新しいサブスクリプションを使用しているという観点から記述されます。

1.  ポータルの下部にある **Cloud Shell** コマンド プロンプトで、次の部分的な **CURL** コマンドを入力して、Logic Apps インスタンスに **HTTP POST** 要求を発行し、次に**[入力]**を押します。

    ```
    curl \
    --header "Content-Type: application/json" \
    --data '{"id":"6","manufacturer":"VEHTOP","price":750,"quantity":6,"name":"car roof rack"}' \
    ```

1.  次に、この演習で前にコピーしたロジック アプリの **HTTP POST URL** を入力し、URL 文字がエスケープされないように**引用符**で囲みます。**Enter** キーを押してコマンドを実行します。

    > **注記**：たとえば、URL が https://prod.eastus.logic.azure.com:443/workflows/test/triggers/invoke?api-version=2016\&sig=3 の場合、"https://prod.eastus.logic.azure.com:443/workflows/test/triggers/manual?invoke?api-version=2016\&sig=3" を挿入します。引用符を含めないと、SAS トークンが切り捨てられ、要求を発行する必要があることを示すエラー メッセージが表示されます。これは、クエリ文字列区切り記号 **&** が引用符で囲まれていない場合に切り捨てられるために発生します。

1.  ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1.  **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1.  **MultiTierService** ブレードで、この実習ラボで前に作成した **prodsearch\** 検索サービスを選択します。

1.  **検索サービス** ブレードで、**インデクサー**タブを選択します。

1.  **インデクサー** タブで、 この実習ラボで前に作成した**テーブルインデクサー** インデクサーを選択します。

1. **インデクサー**ブレードで、次の操作を実行します。
    
    1. **実行** を選択します。
    
    1. 確認を求めるメッセージが表示されたら、**Yes** をクリックします。
    
    1. **インデクサー**ブレードを閉じます。

1. インデクサーの実行が完了するのを待ってから、 ブレードの上部にある**更新**を選択します。

1. **検索サービス** ブレードに戻り、**エクスプローラの検索**を選択 します。

1. **エクスプローラの検索**ブレードで、**検索**を選択します。

1. すべてのドキュメントの検索結果を確認します。

    > **注記**：この時点で、ロジックアプリによって挿入された新しいドキュメントを表すインデックス内の 6 番目のドキュメントが表示されます。

1. ポータルの左側のナビゲーション ウィンドウで、**リソース グループ**を選択 します。

1. **リソース グループ** ブレードで、この実習ラボで前に作成した **MultiTierService** リソースグループを選択します。

1. **MultiTierService** ブレードで、 この実習ラボで前に作成した**prodapi\** API Management アカウントを選択します。

1. **API Management サービス** ブレードで、ブレードの左側にある**API Management** セクションで **API**を選択 します。

1. **API** セクションで、**API の検索** を選択します。

1. **デザイン** タブで、**テスト**タブを選択します。

1. **すべてのドキュメントの一覧**操作を選択します。

1. **すべてのドキュメントの一覧** セクションで、**送信**を選択します。

1. API 要求の結果を確認します。

    > **注記**：5 つではなく 6 つのドキュメントが現在あることに注意してください。

#### 復習

この演習では、HTTP 要求を受け取り、要求の JSON 本体を新しい Azure Storage テーブル エンティティとして保持するロジックアプリを作成しました。

### エクササイズ 5: サブスクリプションのクリーンアップ 

#### タスク 1: Cloud Shell を開く

1.  ポータルの上部で、**Cloud Shell** アイコンを選択して新しいシェル インスタンスを開きます。

1.  ポータルの下部にある **Cloud Shell**コマンド プロンプトで、次のコマンドを入力し、Enter キーを押してサブスクリプション内のすべてのリソース グループを一覧表示します。

    ```
    az group list
    ```

1.  次のコマンドを入力し、Enterキーを押して、リソース グループを削除する可能性のあるコマンドの一覧を表示します。

    ```
    az group delete --help
    ```

#### タスク 2: リソース グループを削除する

1.  次のコマンドを入力し、Enter キーを押して **MultiTierService** リソース グループを削除します。

    ```
    az group delete --name MultiTierService --no-wait --yes
    ```
    
1.  ポータルの下部にある **Cloud Shell** ペインを閉じます。

#### タスク 3: アクティブなアプリケーションを閉じる

1.  現在実行中の **Microsoft Edge** アプリケーションを閉じます。

1.  今実行している **Microsoft Azure Storage Explorer** アプリケーションを閉じます。

#### 復習

この実習では、この演習で使用する **リソース グループ** を削除してサブスクリプションをクリーンアップしました。
